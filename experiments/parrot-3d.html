<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Parrot | Wilhelm Experience</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #0f172a;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        
        .overlay {
            position: absolute;
            top: 2rem;
            left: 2rem;
            color: white;
            z-index: 10;
        }
        
        .overlay h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #e94560;
        }
        
        .overlay p {
            color: #94a3b8;
            max-width: 300px;
        }
        
        .back-link {
            position: absolute;
            top: 2rem;
            right: 2rem;
            color: #e94560;
            text-decoration: none;
            font-weight: 600;
            z-index: 10;
        }
        
        .controls {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            color: #94a3b8;
            font-size: 0.9rem;
            text-align: center;
            z-index: 10;
        }
        
        .avatar-ui {
            position: absolute;
            bottom: 2rem;
            left: 2rem;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            min-width: 250px;
            z-index: 10;
        }
        
        .avatar-ui h3 {
            color: #e94560;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .avatar-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #94a3b8;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #2ecc71;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .mood-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .mood-btn {
            background: rgba(233, 69, 96, 0.2);
            border: 1px solid rgba(233, 69, 96, 0.3);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .mood-btn:hover, .mood-btn.active {
            background: #e94560;
        }
        
        .speech-bubble {
            position: absolute;
            background: white;
            color: #0f172a;
            padding: 1rem 1.5rem;
            border-radius: 20px;
            font-size: 1rem;
            max-width: 250px;
            opacity: 0;
            transform: translateY(10px) scale(0.9);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
            z-index: 20;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }
        
        .speech-bubble.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        .voice-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 3px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .voice-indicator.speaking {
            opacity: 1;
        }
        
        .voice-bar {
            width: 4px;
            height: 20px;
            background: #e94560;
            border-radius: 2px;
            animation: sound-wave 0.5s ease-in-out infinite;
        }
        
        .voice-bar:nth-child(2) { animation-delay: 0.1s; }
        .voice-bar:nth-child(3) { animation-delay: 0.2s; }
        .voice-bar:nth-child(4) { animation-delay: 0.3s; }
        .voice-bar:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes sound-wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1.5); }
        }
    </style>
</head>
<body>
    <div class="overlay">
        <h1>ü¶ú Avatar Prototype</h1>
        <p>This is Wilhelm v0.1 ‚Äî a 3D avatar concept. Move your mouse to engage eye contact. Click to chat!</p>
    </div>
    
    <a href="/experiments/" class="back-link">‚Üê Back to Experiments</a>
    
    <div id="canvas-container"></div>
    
    <div class="speech-bubble" id="speechBubble">
        <div class="voice-indicator" id="voiceIndicator">
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
        </div>
        <span id="bubbleText">Squawk! Hello there!</span>
    </div>
    
    <div class="avatar-ui">
        <h3>üé≠ Avatar Controls</h3>
        <div class="avatar-status">
            <div class="status-dot"></div>
            <span id="statusText">Online ‚Ä¢ Tracking</span>
        </div>
        <div class="mood-selector">
            <button class="mood-btn active" onclick="setMood('neutral')">üòä Neutral</button>
            <button class="mood-btn" onclick="setMood('happy')">ü•≥ Happy</button>
            <button class="mood-btn" onclick="setMood('curious')">ü§î Curious</button>
            <button class="mood-btn" onclick="setMood('sassy')">üòè Sassy</button>
        </div>
    </div>
    
    <div class="controls">
        <p>üñ±Ô∏è Move mouse for eye contact ‚Ä¢ üñ±Ô∏è Click to chat ‚Ä¢ üé≠ Select mood</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0x0f172a, 10, 50);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 7);
        directionalLight.castShadow = true;
        scene.add(directionalLight);
        
        const coralLight = new THREE.PointLight(0xe94560, 0.5, 20);
        coralLight.position.set(-5, 5, -5);
        scene.add(coralLight);

        // Parrot Group
        const parrot = new THREE.Group();
        
        // Body (main body) - using cylinder + spheres for r128 compatibility
        const bodyMaterial = new THREE.MeshPhongMaterial({ 
            color: 0xe94560,
            shininess: 100
        });
        
        // Main body cylinder
        const bodyCylGeometry = new THREE.CylinderGeometry(0.8, 0.8, 1.5, 16);
        const bodyCyl = new THREE.Mesh(bodyCylGeometry, bodyMaterial);
        bodyCyl.rotation.z = Math.PI / 4;
        bodyCyl.castShadow = true;
        parrot.add(bodyCyl);
        
        // Top cap
        const capGeometry = new THREE.SphereGeometry(0.8, 16, 8, 0, Math.PI * 2, 0, Math.PI / 2);
        const topCap = new THREE.Mesh(capGeometry, bodyMaterial);
        topCap.position.set(-0.53, 0.53, 0);
        topCap.rotation.z = Math.PI / 4;
        parrot.add(topCap);
        
        // Bottom cap
        const bottomCap = new THREE.Mesh(capGeometry, bodyMaterial);
        bottomCap.position.set(0.53, -0.53, 0);
        bottomCap.rotation.z = -Math.PI * 3 / 4;
        parrot.add(bottomCap);
        
        // Group for body reference in mood changes
        const body = { material: bodyMaterial };
        
        // Head
        const headGeometry = new THREE.SphereGeometry(0.6, 16, 16);
        const headMaterial = new THREE.MeshPhongMaterial({ color: 0xff6b6b });
        const head = new THREE.Mesh(headGeometry, headMaterial);
        head.position.set(0.8, 1.2, 0);
        head.castShadow = true;
        parrot.add(head);
        
        // Beak (upper)
        const beakGeometry = new THREE.ConeGeometry(0.15, 0.4, 8);
        const beakMaterial = new THREE.MeshPhongMaterial({ color: 0xffa500 });
        const beak = new THREE.Mesh(beakGeometry, beakMaterial);
        beak.rotation.z = -Math.PI / 2;
        beak.position.set(1.3, 1.2, 0);
        parrot.add(beak);
        
        // Eyes
        const eyeGeometry = new THREE.SphereGeometry(0.08, 8, 8);
        const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
        const eyeWhiteMaterial = new THREE.MeshPhongMaterial({ color: 0xffffff });
        
        const leftEyeWhite = new THREE.Mesh(new THREE.SphereGeometry(0.12, 8, 8), eyeWhiteMaterial);
        leftEyeWhite.position.set(1.1, 1.3, 0.25);
        parrot.add(leftEyeWhite);
        
        const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
        leftEye.position.set(1.18, 1.3, 0.28);
        parrot.add(leftEye);
        
        const rightEyeWhite = new THREE.Mesh(new THREE.SphereGeometry(0.12, 8, 8), eyeWhiteMaterial);
        rightEyeWhite.position.set(1.1, 1.3, -0.25);
        parrot.add(rightEyeWhite);
        
        const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
        rightEye.position.set(1.18, 1.3, -0.28);
        parrot.add(rightEye);
        
        // Wings
        const wingGeometry = new THREE.BoxGeometry(1.2, 0.1, 0.6);
        const wingMaterial = new THREE.MeshPhongMaterial({ color: 0x1e3a5f });
        
        const leftWing = new THREE.Mesh(wingGeometry, wingMaterial);
        leftWing.position.set(0, 0.3, 0.7);
        leftWing.rotation.z = Math.PI / 6;
        leftWing.rotation.x = Math.PI / 8;
        parrot.add(leftWing);
        
        const rightWing = new THREE.Mesh(wingGeometry, wingMaterial);
        rightWing.position.set(0, 0.3, -0.7);
        rightWing.rotation.z = Math.PI / 6;
        rightWing.rotation.x = -Math.PI / 8;
        parrot.add(rightWing);
        
        // Tail
        const tailGeometry = new THREE.ConeGeometry(0.3, 1.5, 4);
        const tailMaterial = new THREE.MeshPhongMaterial({ color: 0x0f172a });
        const tail = new THREE.Mesh(tailGeometry, tailMaterial);
        tail.rotation.z = -Math.PI / 3;
        tail.position.set(-1.2, -0.5, 0);
        parrot.add(tail);
        
        // Perch
        const perchGeometry = new THREE.CylinderGeometry(0.1, 0.1, 4, 8);
        const perchMaterial = new THREE.MeshPhongMaterial({ color: 0x8b4513 });
        const perch = new THREE.Mesh(perchGeometry, perchMaterial);
        perch.rotation.z = Math.PI / 2;
        perch.position.set(0, -1.2, 0);
        perch.castShadow = true;
        parrot.add(perch);
        
        // Add parrot to scene
        parrot.position.y = 0.5;
        scene.add(parrot);
        
        // Particles
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 200;
        const posArray = new Float32Array(particlesCount * 3);
        
        for(let i = 0; i < particlesCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 20;
        }
        
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.02,
            color: 0xe94560,
            transparent: true,
            opacity: 0.6
        });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);
        
        // Position camera
        camera.position.z = 5;
        camera.position.y = 1;
        
        // Mouse tracking
        let mouseX = 0;
        let mouseY = 0;
        let targetRotationX = 0;
        let targetRotationY = 0;
        
        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
        });
        
        // Avatar State
        let currentMood = 'neutral';
        let isSpeaking = false;
        let blinkInterval;
        
        const moodResponses = {
            neutral: ["Squawk! Hello there!", "I'm Wilhelm, nice to meet you!", "Move your mouse, I'll follow!"],
            happy: ["üéâ Having a great day!", "Everything is awesome!", "Ready to help with anything!"],
            curious: ["What's on your mind?", "Tell me something interesting!", "I'm all ears... or feathers!"],
            sassy: ["Oh really? Tell me more...", "I've seen things, you know.", "*adjusts feathers dramatically*"]
        };
        
        // Blink animation
        function startBlinking() {
            blinkInterval = setInterval(() => {
                if (!isSpeaking) {
                    leftEye.scale.y = 0.1;
                    rightEye.scale.y = 0.1;
                    leftEyeWhite.scale.y = 0.1;
                    rightEyeWhite.scale.y = 0.1;
                    
                    setTimeout(() => {
                        leftEye.scale.y = 1;
                        rightEye.scale.y = 1;
                        leftEyeWhite.scale.y = 1;
                        rightEyeWhite.scale.y = 1;
                    }, 150);
                }
            }, 3000 + Math.random() * 2000);
        }
        startBlinking();
        
        // Eyebrows for expression (small spheres above eyes)
        const eyebrowGeometry = new THREE.SphereGeometry(0.15, 8, 8);
        const eyebrowMaterial = new THREE.MeshPhongMaterial({ color: 0x1e3a5f });
        
        const leftEyebrow = new THREE.Mesh(eyebrowGeometry, eyebrowMaterial);
        leftEyebrow.position.set(1.1, 1.55, 0.25);
        leftEyebrow.scale.set(1, 0.3, 0.5);
        parrot.add(leftEyebrow);
        
        const rightEyebrow = new THREE.Mesh(eyebrowGeometry, eyebrowMaterial);
        rightEyebrow.position.set(1.1, 1.55, -0.25);
        rightEyebrow.scale.set(1, 0.3, 0.5);
        parrot.add(rightEyebrow);
        
        // Speech bubble functionality
        const speechBubble = document.getElementById('speechBubble');
        const bubbleText = document.getElementById('bubbleText');
        const voiceIndicator = document.getElementById('voiceIndicator');
        
        function showSpeech(text) {
            bubbleText.textContent = text;
            speechBubble.classList.add('visible');
            voiceIndicator.classList.add('speaking');
            isSpeaking = true;
            
            // Wide eyes while speaking
            leftEye.scale.set(1.2, 1.2, 1.2);
            rightEye.scale.set(1.2, 1.2, 1.2);
            
            // Move eyebrows based on mood
            if (currentMood === 'happy') {
                leftEyebrow.position.y = 1.6;
                rightEyebrow.position.y = 1.6;
            } else if (currentMood === 'curious') {
                leftEyebrow.rotation.z = -0.2;
                rightEyebrow.rotation.z = 0.2;
            } else if (currentMood === 'sassy') {
                leftEyebrow.position.y = 1.58;
                rightEyebrow.position.y = 1.52;
            }
            
            setTimeout(() => {
                speechBubble.classList.remove('visible');
                voiceIndicator.classList.remove('speaking');
                isSpeaking = false;
                leftEye.scale.set(1, 1, 1);
                rightEye.scale.set(1, 1, 1);
                leftEyebrow.position.y = 1.55;
                rightEyebrow.position.y = 1.55;
                leftEyebrow.rotation.z = 0;
                rightEyebrow.rotation.z = 0;
            }, 3000);
        }
        
        // Update speech bubble position based on parrot head position
        function updateSpeechBubblePosition() {
            const headPosition = new THREE.Vector3();
            head.getWorldPosition(headPosition);
            headPosition.y += 1.5;
            
            const screenPosition = headPosition.clone().project(camera);
            const x = (screenPosition.x * 0.5 + 0.5) * window.innerWidth;
            const y = (-(screenPosition.y * 0.5) + 0.5) * window.innerHeight;
            
            speechBubble.style.left = x + 'px';
            speechBubble.style.top = y + 'px';
            speechBubble.style.transform = 'translate(-50%, -100%)';
        }
        
        // Mood selector
        window.setMood = function(mood) {
            currentMood = mood;
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Visual feedback
            showSpeech(`Mood: ${mood.charAt(0).toUpperCase() + mood.slice(1)}!`);
            
            // Change body color slightly based on mood
            if (mood === 'happy') {
                body.material.color.setHex(0xff6b6b);
            } else if (mood === 'curious') {
                body.material.color.setHex(0x9b59b6);
            } else if (mood === 'sassy') {
                body.material.color.setHex(0xe74c3c);
            } else {
                body.material.color.setHex(0xe94560);
            }
        };
        
        // Click interaction (chat)
        let isSquawking = false;
        document.addEventListener('click', (e) => {
            // Don't trigger if clicking UI
            if (e.target.closest('.avatar-ui') || e.target.closest('.back-link')) return;
            
            if (!isSquawking && !isSpeaking) {
                isSquawking = true;
                
                // Get random response based on mood
                const responses = moodResponses[currentMood];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                showSpeech(randomResponse);
                
                // Jump animation
                const originalY = parrot.position.y;
                let jumpHeight = 0.5;
                let jumpSpeed = 0.1;
                
                const jump = setInterval(() => {
                    parrot.position.y += jumpSpeed;
                    parrot.scale.setScalar(1 + Math.sin(parrot.position.y * 2) * 0.1);
                    
                    if (parrot.position.y >= originalY + jumpHeight) {
                        jumpSpeed = -jumpSpeed;
                    }
                    if (parrot.position.y <= originalY && jumpSpeed < 0) {
                        parrot.position.y = originalY;
                        parrot.scale.setScalar(1);
                        clearInterval(jump);
                        isSquawking = false;
                    }
                }, 16);
            }
        });
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Smooth rotation towards mouse
            targetRotationY = mouseX * 0.5;
            targetRotationX = mouseY * 0.3;
            
            parrot.rotation.y += (targetRotationY - parrot.rotation.y) * 0.05;
            parrot.rotation.x += (targetRotationX - parrot.rotation.x) * 0.05;
            
            // Idle animation
            const time = Date.now() * 0.001;
            parrot.position.y = 0.5 + Math.sin(time) * 0.05;
            
            // Wing flutter
            leftWing.rotation.z = Math.PI / 6 + Math.sin(time * 3) * 0.05;
            rightWing.rotation.z = Math.PI / 6 - Math.sin(time * 3) * 0.05;
            
            // Breathing (subtle scale)
            if (!isSpeaking && !isSquawking) {
                const breathScale = 1 + Math.sin(time * 2) * 0.02;
                parrot.scale.setScalar(breathScale);
            }
            
            // Particle animation
            particlesMesh.rotation.y = time * 0.1;
            
            // Update speech bubble position
            if (speechBubble.classList.contains('visible')) {
                updateSpeechBubblePosition();
            }
            
            renderer.render(scene, camera);
        }
        
        animate();
        
        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>