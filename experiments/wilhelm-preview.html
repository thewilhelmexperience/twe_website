<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wilhelm 3D Preview | Wilhelm Experience</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        
        .overlay {
            position: absolute;
            top: 2rem;
            left: 2rem;
            color: white;
            z-index: 10;
            background: rgba(15, 23, 42, 0.8);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid rgba(233, 69, 96, 0.3);
            max-width: 300px;
        }
        
        .overlay h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: #e94560;
        }
        
        .overlay p {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .status {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(233, 69, 96, 0.2);
            border-radius: 8px;
            color: #e94560;
            font-size: 0.85rem;
        }
        
        .controls {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            color: #94a3b8;
            font-size: 0.9rem;
            text-align: center;
            z-index: 10;
            background: rgba(15, 23, 42, 0.8);
            padding: 1rem 2rem;
            border-radius: 50px;
        }
        
        .back-link {
            position: absolute;
            top: 2rem;
            right: 2rem;
            color: #e94560;
            text-decoration: none;
            font-weight: 600;
            z-index: 10;
            background: rgba(15, 23, 42, 0.8);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: 1px solid rgba(233, 69, 96, 0.3);
        }
        
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #e94560;
            text-align: center;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="overlay">
        <h1>ü¶ú Wilhelm v1</h1>
        <p>Customized parrot with coral brand colors (#e94560). Your digital avatar!</p>
        <div class="status" id="status">Loading model...</div>
    </div>
    
    <a href="/experiments/" class="back-link">‚Üê Back to Experiments</a>
    
    <div id="canvas-container"></div>
    
    <div class="controls">
        üñ±Ô∏è Drag to rotate ‚Ä¢ üìú Scroll to zoom ‚Ä¢ üëÜ Right-click to pan
    </div>

    <!-- Three.js and GLTF Loader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0f172a);
        scene.fog = new THREE.Fog(0x0f172a, 10, 50);
        
        // Camera
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 8);
        
        // Renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.outputEncoding = THREE.sRGBEncoding;
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        
        // Controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 3;
        controls.maxDistance = 15;
        controls.target.set(0, 1, 0);
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const mainLight = new THREE.DirectionalLight(0xffffff, 1.2);
        mainLight.position.set(5, 10, 5);
        mainLight.castShadow = true;
        mainLight.shadow.mapSize.width = 2048;
        mainLight.shadow.mapSize.height = 2048;
        scene.add(mainLight);
        
        const fillLight = new THREE.DirectionalLight(0xe94560, 0.4);
        fillLight.position.set(-5, 2, -5);
        scene.add(fillLight);
        
        const rimLight = new THREE.SpotLight(0xffffff, 0.8);
        rimLight.position.set(0, 5, -5);
        rimLight.lookAt(0, 0, 0);
        scene.add(rimLight);
        
        // Ground
        const groundGeometry = new THREE.CircleGeometry(10, 64);
        const groundMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x1e293b,
            roughness: 0.8,
            metalness: 0.2
        });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -0.5;
        ground.receiveShadow = true;
        scene.add(ground);
        
        // Load the Wilhelm model
        const loader = new THREE.GLTFLoader();
        const statusEl = document.getElementById('status');
        
        loader.load(
            'models/wilhelm/Wilhelm-v1.glb',
            function(gltf) {
                const parrot = gltf.scene;
                
                // Scale and position
                parrot.scale.set(2, 2, 2);
                parrot.position.set(0, 0, 0);
                
                // Enable shadows
                parrot.traverse(function(node) {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;
                        
                        // Log materials for debugging
                        if (node.material) {
                            console.log('Material:', node.material.name || 'unnamed', node.material.color);
                        }
                    }
                });
                
                // Center the model
                const box = new THREE.Box3().setFromObject(parrot);
                const center = box.getCenter(new THREE.Vector3());
                parrot.position.sub(center);
                parrot.position.y += 1;
                
                scene.add(parrot);
                
                // Check for animations
                if (gltf.animations && gltf.animations.length > 0) {
                    const mixer = new THREE.AnimationMixer(parrot);
                    gltf.animations.forEach((clip, index) => {
                        console.log('Animation:', clip.name || `anim_${index}`);
                    });
                    statusEl.textContent = `‚úÖ Model loaded! ${gltf.animations.length} animation(s) found`;
                } else {
                    statusEl.textContent = '‚úÖ Model loaded! (no animations - static model)';
                }
                
                console.log('Parrot model loaded successfully!');
                console.log('Scene info:', gltf.scene);
            },
            function(xhr) {
                const percent = Math.round((xhr.loaded / xhr.total) * 100);
                statusEl.textContent = `Loading... ${percent}%`;
            },
            function(error) {
                console.error('Error loading model:', error);
                statusEl.textContent = '‚ùå Error loading model (check console)';
            }
        );
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
        
        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>